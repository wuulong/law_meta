# 法律元資料框架之系統架構與使用指南

## 1. 總覽

本系統「法律元資料框架」旨在將法律文本轉換為結構化、機器可讀的格式。本系統運用大型語言模型（LLMs），特別是 Google 的 Gemini 模型，根據預定義的規範來分析法律文件並提取各種類型的元資料。這些結構化的元資料隨後可用於多種目的，包括法律分析、搜尋以及建立知識圖譜。

系統的核心是一個 Jupyter Notebook (`law_meta_loader.ipynb`)，它負責協調元資料的生成、管理和查詢過程。

## 2. 系統架構

本系統由數個關鍵組件構成，這些組件相互作用以達成其目標：

**2.1. 核心組件：**

*   **輸入法律文件（`.md` 檔案）：**
    *   這些是包含法律或法規原始文本的 Markdown 檔案（例如，`政府採購法.md`）。它們是本系統的主要輸入。
*   **規格文件（`法律語法形式化.md`）：**
    *   這個關鍵的 Markdown 檔案定義了系統旨在提取的五種元資料的綱要和結構。它為大型語言模型提供了生成準確且一致元資料的框架和範例。
*   **元資料 JSON 檔案（`json/` 目錄）：**
    *   系統的結構化輸出儲存在每個已處理法律的一組五個 JSON 檔案中。這些檔案使用法律名稱作為前綴命名：
        *   `{law_name}_law_regulation.json`：包含關於該法律本身的一般元資料（例如，名稱、類別、目的）。
        *   `{law_name}_legal_concepts.json`：列出並定義在該法律中找到的關鍵法律概念。
        *   `{law_name}_hierarchy_relations.json`：描述此法律與其他法律之間的層級關係（例如，母法、子法規）。
        *   `{law_name}_law_relations.json`：詳細說明此法律或其條文與其他法律或條文的其他類型關係。
        *   `{law_name}_law_articles.json`：提供法律中每個條文的詳細、結構化分解，包括其意義、概念和條文內部關係。
*   **處理引擎（`law_meta_loader.ipynb`）：**
    *   此 Jupyter Notebook 包含驅動整個系統的 Python 程式碼。其職責包括：
        *   與大型語言模型（Gemini API）互動，以傳送提示並接收生成的元資料。
        *   將大型語言模型的輸出（最初是文本）解析為結構化的 JSON。
        *   管理元資料的生命週期：從 JSON 檔案載入、更新和存回。
        *   提供查詢和分析元資料的功能。
*   **暫存文字檔案（`txt/` 目錄）：**
    *   此目錄用作暫存區。來自大型語言模型的原始文本輸出，其中包含生成的元資料（通常在 JSON Markdown 區塊內），會先儲存在此處，然後再解析並轉換為 `json/` 目錄中的最終 JSON 檔案。

**2.2. 新法律處理的資料流程：**

1.  **準備：** 將新的法律文件準備為 Markdown 檔案（例如，`new_law.md`）。
2.  **大型語言模型互動：**
    *   執行 `law_meta_loader.ipynb` 筆記本。
    *   使用者指定與 `new_law.md` 對應的 `law_name`。
    *   筆記本將 `new_law.md` 和 `法律語法形式化.md`（規格）上傳到 Gemini 大型語言模型。
3.  **元資料生成：**
    *   筆記本向大型語言模型傳送一系列預定義的提示，指示其根據 `new_law.md` 的內容和 `法律語法形式化.md` 中定義的結構生成五種類型的元資料。
4.  **中繼儲存：** 大型語言模型的文本回應儲存到 `txt/` 目錄中的對應檔案（例如，`new_law_law_regulation.txt`）。
5.  **解析與 JSON 建立：**
    *   筆記本從 `txt/` 目錄讀取這些文字檔案。
    *   使用正規表示式（`handle_regex` 函數）從大型語言模型的輸出中提取 JSON 內容（通常嵌入在 ```json ... ``` 區塊中）。
    *   提取的資料隨後被結構化並儲存為 `json/` 目錄中各自的 JSON 檔案（例如，`json/new_law_law_regulation.json`）。

## 3. 使用指南

本系統的主要操作介面是 `law_meta_loader.ipynb` Jupyter Notebook。

**3.1. 設定環境：**

*   確保已安裝 Python。
*   安裝必要的函式庫：`google-generativeai`（用於 Gemini API）、`json`、`re`、`os`。
*   設定您的 `GEMINI_API_KEY` 作為環境變數，以便與大型語言模型互動。

**3.2. 處理新法律：**

1.  **建立 Markdown 檔案：** 將新法律的文本放入根目錄中的一個 `.md` 檔案（例如，`民法.md`）。
2.  **設定筆記本以進行大型語言模型生成：**
    *   開啟 `law_meta_loader.ipynb`。
    *   在「LLM 建構 json」部分，將 `law_name` 變數設定為新法律檔案的基本名稱（例如，`law_name="民法"`）。
    *   確保為大型語言模型互動、檔案上傳和元資料生成步驟啟用相關開關（例如，`if 1: # 設定 LLM...`）。
3.  **執行生成儲存格：** 執行負責以下操作的筆記本儲存格：
    *   初始化 Gemini 用戶端。
    *   上傳新法律的 `.md` 檔案和 `法律語法形式化.md`。
    *   生成非條文元資料（法規、概念、層級、關係）。這包括傳送提示以及儲存/解析回應。
    *   生成條文元資料（由於大型語言模型的上下文限制，這通常分批進行）。這也包括提示、儲存和解析。
4.  **驗證輸出：** 檢查 `json/` 目錄中是否有與您的法律對應的新建立的 JSON 檔案。

**3.3. 管理與查詢現有元資料：**

*   **載入資料：**
    *   `LawMetadata` 類別可以載入特定法律的 5 個 JSON 檔案。
    *   `LawMetadataMgr` 類別可以載入 `json/` 目錄中找到的多個（或所有）法律的元資料。
*   **存取資料：** 載入後，元資料可以作為 Python 物件（字典和列表）進行存取。
*   **更新資料：**
    *   `LawMetadata` 物件有一個 `renew_id()` 方法，可確保元資料中的唯一 ID。
    *   可以直接對 Python 物件進行修改，然後使用 `to_json_files()` 存回。
*   **查詢：**
    *   筆記本包含以下範例函數：
        *   在特定元資料欄位中進行關鍵字搜尋。
        *   按類別篩選元資料（例如，尋找所有「子法規」）。
        *   組合搜尋。
        *   生成 Mermaid 圖表以視覺化法律層級或條文關係。
    *   使用者可以調整這些函數或建立新的函數以滿足其特定的分析需求。

**3.4. 主要 Python 類別：**

*   **`LawMetadata`**：
    *   代表單一法律的所有元資料。
    *   `from_json_files()`：類別方法，用於從五種 JSON 檔案類型載入資料。
    *   `to_json_files()`：將元資料存回 JSON 檔案的方法。
    *   `renew_id()`：標準化和更新元資料中唯一識別碼的方法。
*   **`LawMetadataMgr`**：
    *   管理 `LawMetadata` 物件的集合。
    *   `load_lm_bynames()`：從 `json/` 目錄載入指定的法律。
    *   提供跨多個法律進行操作的中心點。

## 4. 主要功能

*   **大型語言模型驅動的元資料提取：** 利用 Gemini 根據正式規格從原始法律文本中生成結構化元資料。
*   **全面的元資料綱要：** 擷取五種不同類型的法律元資料：法規概述、法律概念、層級結構、法律間關係以及詳細的條文分解。
*   **資料持久性：** 將生成的元資料儲存在易於存取的 JSON 檔案中。
*   **模組化元資料管理：** Python 類別允許載入、存取、修改和儲存個別法律或法律集合的元資料。
*   **ID 管理：** 包含為不同元資料元素生成和更新唯一 ID 的功能。
*   **條文批次處理：** 透過將條文元資料分塊生成來處理可能很長的法律文件。
*   **查詢與分析：** 提供用於搜尋、篩選和視覺化結構化法律資料的基礎工具。
*   **可擴展性：** 基於 Python 的方法和結構化的 JSON 輸出有利於進一步開發分析工具和應用程式。

## 5. 目錄結構摘要

*   **`/` (根目錄)：**
    *   `law_meta_loader.ipynb`：主要處理筆記本。
    *   `法律語法形式化.md`：元資料規格。
    *   `*.md`：法律的來源 Markdown 檔案（例如，`政府採購法.md`）。
    *   `sw_arch.md`：本文件。
*   **`json/`：** 包含所有最終的結構化 JSON 元資料檔案。
*   **`txt/`：** 在元資料生成期間，用於儲存來自大型語言模型的原始文本輸出的暫存空間。

本文件提供了系統架構和使用的概況。有關更詳細的範例和具體的實作細節，請參閱 `law_meta_loader.ipynb` 筆記本中的註解和程式碼。
